{% extends "layout.html" %}
{% block title %}Etusivu{% endblock %}
{% block content %}
<h1>Tervetuloa!</h1>
<p>
    {% if "user" in session %}
    <a href="/newTopic">Uusi aihe</a>
    {% endif %}
    <hr>
    <form action="/" method="POST">
        Haku:<br>
        <input type="text" name="search" placeholder="Etsi sanoilla" value="{{session['search']}}"><br><br>
        Aihealue:<br>
        <select name="theme">
            {% for i in range(session['theme']|length) %}
                {% if session['theme'][i][1] %}
                    <option value="{{session['theme'][i][0]}}" selected>{{session['theme'][i][0]}}</option>
                {% else %}
                    <option value="{{session['theme'][i][0]}}">{{session['theme'][i][0]}}</option>
                {% endif %}
            {% endfor %}
        </select>
        <br>
        Järjestä:<br>
        <select name="sort">
            {% for i in range(session['sort']|length) %}
                {% if session['sort'][i][1] %}
                    <option value="{{session['sort'][i][0]}}" selected>{{session['sort'][i][0]}}</option>
                {% else %}
                    <option value="{{session['sort'][i][0]}}">{{session['sort'][i][0]}}</option>
                {% endif %}
            {% endfor %}
        </select>
        <br>
        Aiheita per sivu:<br>
        <select name="topics_per_page">
            {% for i in range(session['topics_per_page']|length) %}
                {% if session['topics_per_page'][i][1] %}
                    <option value="{{session['topics_per_page'][i][0]}}" selected>{{session['topics_per_page'][i][0]}}</option>
                {% else %}
                    <option value="{{session['topics_per_page'][i][0]}}">{{session['topics_per_page'][i][0]}}</option>
                {% endif %}
            {% endfor %}
        </select>
        <br>
        <input type="submit" value="päivitä">
    </form>
    
    {% for topic in topics %}
    <hr>
    <!-- 0: topic_id, 1: otsikko, 2: info, 3: luoja 4: aika 5: pic_name, 6: pic_data, 7:profile_pic_data, 8: upvotes, 9: downvotes, 10:message_count, 11: vote-->
        <a href="/topic{{topic[0]}}"><b>{{topic[1]}}</b></a> <br><br>
        {% if 100 > topic[2]|length %} <!-- esikatselu on 100 merkkiä pitkä -->
            {{topic[2]}} <br>
        {% else %}
            {{topic[2][:100] + " ..."}}
        {% endif %}

        {% if topic[5] != None %}
            <div style="width: 128px; height: 128px;">
                <img src="data:image/jpeg;base64,{{topic[6]}}" alt="{{topic[5]}}" style="width: inherit">
            </div>
        {% endif %}
        <br>
        luonut:
        {% if topic[7] != None %}
        <div style="width: 15px; height: 15px; display: inline;">
            <img src="data:image/jpeg;base64,{{topic[7]}}" alt="Profiilikuva" style="width: inherit">
        </div>
        {% endif %}
        {{topic[3]}}, {{topic[4].strftime("%Y-%m-%d %H:%M")}} <br>
        Viestejä: {{topic[10]}} kpl<br>
        {% if 'user' in session %}
            <form action="/topic_like" method="POST">
                <input type="hidden" name="topic_id" value="{{topic[0]}}">
                {{topic[8]}}
                {% if topic[11] == None or topic[11] == 0%}
                    <input type="image" name="upvote" value="1" src="/static/images/thumb_off1.png" alt="Submit" style="width: 25px" />
                {% elif topic[11] == 1 %}
                    <input type="image" name="upvote" value="1" src="/static/images/thumb_on1.png" alt="Submit" style="width: 25px" />
                {% endif %}
                {{topic[9]}}
                {% if topic[11] == None or topic[11] == 1%}
                    <input type="image" name="downvote" value="0" src="/static/images/thumb_off1.png" alt="Submit"
                        style="width: 25px; transform: rotate(180deg);" />
                {% elif topic[11] == 0 %}
                    <input type="image" name="downvote" value="0" src="/static/images/thumb_red.png" alt="Submit"
                        style="width: 25px; transform: rotate(180deg);" />
                {% endif %}
            </form>
        {% else %}
            <form action="/login" method="GET">
                <input type="hidden" name="topic_id" value="{{topic[0]}}">
                {{topic[8]}}
                <input type="image" name="upvote" value="1" src="/static/images/thumb_off1.png" alt="Submit" style="width: 25px" />
                {{topic[9]}}
                <input type="image" name="downvote" value="0" src="/static/images/thumb_off1.png" alt="Submit"
                    style="width: 25px; transform: rotate(180deg);" />
            </form>
        {% endif %}
    {% endfor %}
</p>
{% if page_count > 1%}
<div>
    sivut:
    <form action="/" method="POST">
        {% if page_count > 5 %}
            {% if current > 1 %}
                <input type="submit" name="page" value="edellinen">
            {% endif %}
            {% if 3 >= current %}
                {% for i in range(1, 6) %}
                    {% if i == current %}
                        <input type="submit" name="page" value="{{i}}" style="background-color: lightskyblue;">
                    {% else %}
                        <input type="submit" name="page" value="{{i}}">
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if current > 3 %}
                <input type="submit" name="page" value="1"> ...
            {% endif %}
            {% if current >= page_count-2 %}
                {% for i in range(page_count-4, page_count+1) %}
                    {% if i == current %}
                        <input type="submit" name="page" value="{{i}}" style="background-color: lightskyblue;">
                    {% else %}
                        <input type="submit" name="page" value="{{i}}">
                    {% endif %}
                {% endfor %}
            {% elif current > 3 %}
                {% for i in range(current-2, current+3) %}
                    {% if i == current %}
                        <input type="submit" name="page" value="{{i}}" style="background-color: lightskyblue;">
                    {% else %}
                        <input type="submit" name="page" value="{{i}}">
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if page_count-3 >= current %}
                ... <input type="submit" name="page" value="{{page_count}}">
            {% endif %}
        {% else %}
            {% if current > 1 %}
                <input type="submit" name="page" value="edellinen">
            {% endif %}
            {% for i in range(1, page_count+1) %}
                {% if i == current %}
                    <input type="submit" name="page" value="{{i}}" style="background-color: lightskyblue;">
                {% else %}
                    <input type="submit" name="page" value="{{i}}">
                {% endif %}
            {% endfor %}
            {% if page_count > current %}
                <input type="submit" name="page" value="seuraava">
            {% endif %}
        {% endif %}
    </form>
</div>
{% endif %}
{% endblock %}